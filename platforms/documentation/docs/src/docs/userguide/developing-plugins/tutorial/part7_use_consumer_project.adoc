// Copyright (C) 2024 Gradle, Inc.
//
// Licensed under the Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International License.;
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      https://creativecommons.org/licenses/by-nc-sa/4.0/
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

[[part7_use_consumer_project]]
= Part 7: Use a Consumer Project

Learn how to set up a dummy `consumer` project to test your plugin.

****
**In this section, you will:**

- Create a `consumer` Project
- Test the Plugin
****

[[part7_begin]]
== Step 0. Before you Begin

1. You initialized your plugin in <<part1_gradle_init_plugin.adoc#part1_begin,part 1>>.
2. You added an extension to your plugin in <<part2_add_extension.adoc#part2_begin,part 2>>.
3. You created a custom task in <<part3_create_custom_task.adoc#part3_begin, part3>>.
4. You wrote a unit test in <<part4_unit_test.adoc#part4_begin,part 4>>.
5. You added a dataflow action to your plugin in <<part5_add_dataflow_action.adoc#part5_begin,part 2>>.
6. You wrote a functional test in <<part6_functional_test.adoc#part6_begin,part 6>>.

== Step 1. Create `consumer` Project

Create a sibling consumer build to try the plugin without publishing anything.
Update your directory structure so it looks as follows:

[.multi-language-sample]
=====
[source, kotlin]
----
.
├── gradlew
├── settings.gradle.kts
├── plugin/
└── consumer/   //<1>
    ├── settings.gradle.kts
    └── build.gradle.kts
----
<1> Create a `consumer` project
=====
[.multi-language-sample]
=====
[source, groovy]
----
.
├── gradlew
├── settings.gradle
├── plugin/
└── consumer/   //<1>
    ├── settings.gradle
    └── build.gradle
----
<1> Create a `consumer` project
=====

== Step 2. Wire the `consumer` to include the `plugin`

Wire the `consumer` to the plugin via `pluginManagement {}`

In `consumer/settings.gradle.kts`, add the following code:

[source,kotlin]
----
rootProject.name = "consumer"

pluginManagement {
includeBuild("../plugin")
    repositories {
        gradlePluginPortal()
    }
}
----

`includeBuild("../plugin")` makes the plugin from the plugin directory available by its ID without publishing.

== Step 3. Apply and configure the plugin in the `consumer`

In `consumer/build.gradle.kts`:

[source,kotlin]
----
plugins {
    id("org.example.slack") // your plugin ID from gradlePlugin { plugins { id = ... } }
}

slack {
    token.set(System.getenv("SLACK_TOKEN") ?: "dummy-token")
    channel.set("#build-notifications")
    message.set("Hello from consumer via composite build!")
}
----

No version is needed, the plugin is resolved from the included build.

== Step 4. Run the `consumer`

From the `consumer` directory:

[source,text]
----
./gradlew sendSlackMessage
----

You can also simply run:

[source,text]
----
./gradlew build
----

And see the Slack message.

That’s it!
You can now iterate on the plugin in `plugin/`, and immediately test it in `consumer/` with zero publishing friction.

Let's take a look at another way to implement this plugin.

[.text-right]
**Next Step:** <<part8_add_build_listener.adoc#part8_add_build_listener,Add a Build Listener>> >>
