// Copyright (C) 2024 Gradle, Inc.
//
// Licensed under the Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International License.;
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      https://creativecommons.org/licenses/by-nc-sa/4.0/
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

[[part3_create_custom_task]]
= Part 3: Creating Tasks

Learn about custom task types, create one, and add one to your plugin.

****
**In this section, you will:**

- Understand Custom Task Types in Plugins
- Add a Custom Task to the Slack Plugin
****

[[part3_begin]]
== Step 0. Before you Begin

1. You initialized your plugin in <<part1_gradle_init_plugin.adoc#part1_begin,part 1>>.
2. You added an extension to your plugin in <<part2_add_extension.adoc#part2_begin,part 2>>.

== Step 1. About Custom Tasks

To make your plugin actually do something, youâ€™ll need to define a custom task type and register a task of that type in your plugin.

In this case, the task will send a message to Slack using the configuration provided by the user.

== Step 2. Create a Custom Task Type

[.multi-language-text.lang-kotlin]
----
Create a new file called `SlackTask.kt` `src/main/kotlin/org/example/` and add the following code:
----
[.multi-language-text.lang-groovy]
----
Create a new file called `SlackTask.groovy` `src/main/groovy/org/example/` and add the following code:
----

====
include::sample[dir="snippets/plugins/plugin-tutorial/kotlin",files="plugin/src/main/kotlin/org/example/SlackTask.kt[]"]
include::sample[dir="snippets/plugins/plugin-tutorial/groovy",files="plugin/src/main/groovy/org/example/SlackTask.groovy[]"]
====

This custom task type:

* Declares three input properties: `token`, `channel`, and `message`.
* In the `@TaskAction`, it uses the link:https://github.com/slackapi/java-slack-sdk[Slack API client] to post a message.
* If the message is sent successfully, it prints a confirmation to the console.
* If something goes wrong, the task fails the build with a clear error message.

== Step 3. Add the Slack API Dependency

The Slack API client is a dependency so you need to add it in your build file:

====
include::sample[dir="snippets/plugins/plugin-tutorial/kotlin",files="plugin/build.gradle.kts[tags=slack-api]"]
include::sample[dir="snippets/plugins/plugin-tutorial/groovy",files="plugin/build.gradle.kts[tags=slack-api]"]
====

== Step 4. Register it in the Plugin

Now that you've defined a custom task class (`SlackTask`), you need to register it in your plugin so users can run `./gradlew sendSlackMessage` from their project.

[.multi-language-text.lang-kotlin]
----
Open your plugin implementation file, `SlackPlugin.kt` (in `src/main/kotlin/org/example/`), and modify or confirm it looks like this:
----
[.multi-language-text.lang-groovy]
----
Open your plugin implementation file, `SlackPlugin.groovy` (in `src/main/groovy/org/example/`), and modify or confirm it looks like this:
----

====
include::sample[dir="snippets/plugins/plugin-tutorial/kotlin",files="plugin/src/main/kotlin/org/example/SlackPlugin.kt[tags=slack-task]"]
include::sample[dir="snippets/plugins/plugin-tutorial/groovy",files="plugin/src/main/groovy/org/example/SlackPlugin.groovy[tags=slack-task]"]
====

What this does:

* Registers a user-facing configuration block (`slack {}`) via the `SlackExtension` class.
* Registers a task named `sendSlackMessage` of type `SlackTask`.
* Binds the task's `token`, `channel`, and `message` properties to the values defined by the user in the build script.

[.text-right]
**Next Step:** <<part4_unit_test.adoc#part4_unit_test,Write a Unit Test>> >>
