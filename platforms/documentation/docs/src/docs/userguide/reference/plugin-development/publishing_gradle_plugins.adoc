// Copyright (C) 2024 Gradle, Inc.
//
// Licensed under the Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International License.;
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      https://creativecommons.org/licenses/by-nc-sa/4.0/
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

[[publishing_portal]]
= Publishing Plugins to the Gradle Plugin Portal
:portal: Gradle Plugin Portal
:plugin: Greeting Plugin
:publishplugin: Plugin Publishing Plugin
:plugin-reference-documentation: https://plugins.gradle.org/docs/publish-plugin[reference documentation of the {publishplugin}]
:keywords: publish, publishing, plugin

Publishing your plugin is the primary way to make it available to other builds.
While you can publish to private repositories to restrict access, publishing to the link:https://plugins.gradle.org[{portal}] makes your plugin discoverable and usable worldwide.

image::plugin-portal-page.png[]

== Account setup

Before publishing, create a {portal} account and generate an API key:

- Register at the link:https://plugins.gradle.org/user/register[Portal registration page].
- Retrieve your API key from the “API Keys” tab in your profile.

image::plugin-portal-registration-page.png[]

Provide the credentials as Gradle properties (`gradle.publish.key` and `gradle.publish.secret`) — usually in <<build_environment.adoc#sec:gradle_configuration_properties,`$HOME/.gradle/gradle.properties`>> — or supply them via environment variables (`GRADLE_PUBLISH_KEY` and `GRADLE_PUBLISH_SECRET`), which is convenient for CI/CD.

For secure property management, you can use the link:https://plugins.gradle.org/plugin/de.qaware.seu.as.code.credentials[Seauc Credentials plugin].

== Adding the {publishplugin}

Add the `com.gradle.plugin-publish` plugin to your build:

++++
<div style="text-align: right;">
  <a href="https://github.com/gradle/gradle/tree/master/platforms/documentation/docs/src/snippets/developingPlugins/publishingPlugins">
    <img src="https://img.shields.io/badge/View%20full%20project-GitHub-blue?logo=github&style=flat" alt="View full sample project on GitHub"/>
  </a>
</div>
++++

====
include::sample[dir="snippets/developingPlugins/publishingPlugins/kotlin",files="build.gradle.kts[tags=plugins_block]"]
include::sample[dir="snippets/developingPlugins/publishingPlugins/groovy",files="build.gradle[tags=plugins_block]"]
====

The latest version is listed on the link:https://plugins.gradle.org/plugin/com.gradle.plugin-publish[{portal}].

NOTE: Since version 1.0.0, the Plugin Publish Plugin automatically applies the
<<java_gradle_plugin.adoc#java_gradle_plugin,Java Gradle Plugin Development Plugin>> (for building plugins) and the
<<publishing_maven.adoc#publishing_maven,Maven Publish Plugin>> (for generating metadata).
Older versions required applying these plugins manually.

== Configuring the {publishplugin}

Configure the plugin in `build.gradle(.kts)`:

++++
<div style="text-align: right;">
  <a href="https://github.com/gradle/gradle/tree/master/platforms/documentation/docs/src/snippets/developingPlugins/publishingPlugins">
    <img src="https://img.shields.io/badge/View%20full%20project-GitHub-blue?logo=github&style=flat" alt="View full sample project on GitHub"/>
  </a>
</div>
++++

====
include::sample[dir="snippets/developingPlugins/publishingPlugins/kotlin",files="build.gradle.kts[tags=global_config]"]
include::sample[dir="snippets/developingPlugins/publishingPlugins/groovy",files="build.gradle[tags=global_config]"]
====
<1> Set `group` to identify your published artifacts.
<2> Set `version` for the plugin release.
<3> Use the `gradlePlugin` block to define plugin metadata.
<4> Add your project website.
<5> Add a source repository link (optional but helpful).
<6> Provide per-plugin details.

Define plugin-specific properties inside the `gradlePlugin {}` block:

====
include::sample[dir="snippets/developingPlugins/publishingPlugins/kotlin",files="build.gradle.kts[tags=per_plugin_config]"]
include::sample[dir="snippets/developingPlugins/publishingPlugins/groovy",files="build.gradle[tags=per_plugin_config]"]
====
<1> Each plugin gets its own block inside `plugins`.
<2> The block name is local to your build.
<3> Set a unique `id`.
<4> Give the plugin a human-readable name and description.
<5> Optionally set categories to improve discoverability.

For example, the configuration for the https://plugins.gradle.org/plugin/org.ysb33r.gradletest[GradleTest plugin]:

====
include::sample[dir="snippets/developingPlugins/publishingPlugins/kotlin",files="build.gradle.kts[tags=plugin_example]"]
include::sample[dir="snippets/developingPlugins/publishingPlugins/groovy",files="build.gradle[tags=plugin_example]"]
====

image::plugin-portal-plugin-page.png[]

=== Sources & Javadoc

The Plugin Publish Plugin automatically creates and publishes <<building_java_projects.adoc#sec:java_packaging,Javadoc and sources JARs>>.

=== Signing artifacts

From version 1.0.0, applying the <<signing_plugin.adoc#signing_plugin,`signing`>> plugin automatically signs plugin artifacts.

=== Shadow dependencies

From version 1.0.0, applying https://github.com/GradleUp/shadow[`com.gradleup.shadow`] automatically creates fat JARs for plugins.

[[sec:publishing_your_plugin]]
== Publishing the plugin

To publish to the {portal}:

[listing]
----
$ ./gradlew publishPlugins
----

Validate before publishing:

[listing]
----
$ ./gradlew publishPlugins --validate-only
----

You can also pass credentials on the command line:

[listing]
----
$ ./gradlew publishPlugins -Pgradle.publish.key=<key> -Pgradle.publish.secret=<secret>
----

After approval, your plugin appears on the Portal and is available for anyone to use.

[[consume]]
== Consuming your plugin

Initial approval of a new plugin is manual and may take time; updates after the first release are automatic.
Once approved, usage instructions are available at *+https://plugins.gradle.org/plugin/<your-plugin-id>+*.

== Plugins published without {portal}

If you published a plugin without using the <<java_gradle_plugin.adoc#java_gradle_plugin,Java Gradle Plugin Development Plugin>>, the publication will lack the <<plugins_intermediate.adoc#sec:plugin_markers,Plugin Marker Artifact>> required by the plugins DSL.
To use such a plugin, add a `resolutionStrategy` block inside `pluginManagement {}` in the consuming project’s `settings.gradle(.kts)`:

++++
<div style="text-align: right;">
  <a href="https://github.com/gradle/gradle/tree/master/platforms/documentation/docs/src/snippets/plugins/customPlugin">
    <img src="https://img.shields.io/badge/View%20full%20project-GitHub-blue?logo=github&style=flat" alt="View full sample project on GitHub"/>
  </a>
</div>
++++

====
include::sample[dir="snippets/plugins/customPlugin/kotlin/consumer",files="settings.gradle.kts[tags=use-legacy-plugin]"]
include::sample[dir="snippets/plugins/customPlugin/groovy/consumer",files="settings.gradle[tags=use-legacy-plugin]"]
====
